/*
CREATE TABLE atimo_dev.FAT_EMPRESA_CONFIG
(
	COD_EMPRESA INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	CNPJ	VARCHAR(14),
	SERIAL_CERTIFICADO VARCHAR(100) NOT NULL,
	CCM_PMSP	VARCHAR(10),
	CODSERVICO_PMSP VARCHAR(4),
	ULTIMA_RPS INT NOT NULL DEFAULT 0,
	PERCENT_CARGA_TRIB DECIMAL(18, 2),
	FONTE_CARGA_TRIB VARCHAR(10)
)
*/
-- OK
CREATE TABLE [saobento_sistema].[EMPRESA](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[NOME] [varchar](200) NULL,
	[SERIAL_CERTIFICADO] [varchar](300) NULL,
	[CNPJ] [varchar](14) NULL,
	[COD_SERVICO_PMSP] [varchar](100) NULL,
	[CCM_PMSP] [varchar](100) NULL,
	[FLG_EMITE_NF] [char](1) NULL,
	[NUM_ULTIMA_RPS] [int] NULL,
	[FLG_OPTANTE_SIMPLES_NACIONAL] [char](1) NULL,
	[NOM_FONTE_CARGA_TRIB] [varchar](100) NULL,
	[PERC_CARGA_TRIB] [decimal](3, 2) NULL,
 CONSTRAINT [PK_dbo.EMPRESA] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

/*
CREATE TABLE atimo_dev.FAT_TIPO_IMPOSTO
(
	CODIGO INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	NOME VARCHAR(30) NOT NULL,
	ALIQUOTA DECIMAL(5, 2) NOT NULL,
	TETO_INSS DECIMAL(18, 2),
	VALOR_MINIMO DECIMAL(18, 2)
)
*/
--OK
CREATE TABLE [saobento_sistema].FAT_TIPO_IMPOSTO
(
	ID INT NOT NULL IDENTITY(1,1),
	NOME VARCHAR(30) NOT NULL,
	ALIQUOTA DECIMAL(5, 2) NOT NULL,
	TETO_INSS DECIMAL(18, 2),
	VALOR_MINIMO DECIMAL(18, 2),
	 CONSTRAINT [PK_dbo.SFAT_TIPO_IMPOSTO] PRIMARY KEY CLUSTERED 
	(
		[ID] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
)

--CREATE TABLE atimo_dev.FAT_CODIGOSERVICO_PMSP
--(
--	CODIGO_SERVICO VARCHAR(4) NOT NULL PRIMARY KEY,
--	DESCRICAO_SERVICO VARCHAR(150) NOT NULL,
--	ALIQUOTA_ISS	DECIMAL(18, 2) NOT NULL
--)
--OK
CREATE TABLE [saobento_sistema].[FAT_SERVICOS_PMSP](
	[ID] [varchar](4) NOT NULL,
	[DESCRICAO] [varchar](300) NULL,
	[ALIQUOTA] [decimal](3, 2) NULL,
	[DATA_INICIO] [datetime] NULL,
 CONSTRAINT [PK_dbo.SERVICOS_PMSP] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

CREATE TABLE atimo_dev.TIPOPAGTO
(
	CODIGO INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	DESCRICAO VARCHAR(30)
)

CREATE TABLE atimo_dev.SITUACAOPAGTO
(
	CODIGO INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	DESCRICAO VARCHAR(30)
)

--CREATE TABLE atimo_dev.FAT_FATURAMENTO
--(
--	ID_FATURAMENTO INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
--	ID_OSSB INT NOT NULL FOREIGN KEY REFERENCES atimo_dev.OSSB(ID),
--	VALOR_BRUTO DECIMAL(18, 2) NOT NULL,
--	DATA_EMISSAO_NF DATETIME,
--	NUMERO_NF	INT,
--	COD_VERIFICACAO_NF VARCHAR(8),
--	COD_EMPRESA INT NOT NULL REFERENCES atimo_dev.FAT_EMPRESA_CONFIG(COD_EMPRESA),
--	DATA_CADASTRO DATETIME NOT NULL,
--	DESCRICAO_NF VARCHAR(8000),
--	CANCELADA CHAR(1) NOT NULL DEFAULT 'N',
--	NUMERO_RPS INT NOT NULL,
--	COD_TIPOPAGTO INT REFERENCES atimo_dev.TIPOPAGTO(CODIGO),
--	COD_SITUACAOPAGTO INT REFERENCES atimo_dev.SITUACAOPAGTO(CODIGO),
--	CODIGOSERVICO_PMSP VARCHAR(4) REFERENCES atimo_dev.FAT_CODIGOSERVICO_PMSP(CODIGO_SERVICO)
--)
-- OK
CREATE TABLE saobento_sistema.FAT_FATURAMENTO
(
	ID INT NOT NULL IDENTITY(1,1),
	ID_OSSB INT NOT NULL,
	VALOR_BRUTO DECIMAL(18, 2) NOT NULL,
	DATA_EMISSAO_NF DATETIME,
	NUMERO_NF	INT,
	COD_VERIFICACAO_NF VARCHAR(8),
	ID_EMPRESA INT NOT NULL,
	DATA_CADASTRO DATETIME NOT NULL,
	DESCRICAO_NF VARCHAR(8000),
	FLAG_CANCELADA CHAR(1) NOT NULL DEFAULT 'N',
	NUMERO_RPS INT NOT NULL,
	ID_SERVICO_PMSP VARCHAR(4) NULL,
	ID_CLIENTE INT NOT NULL,
	NUM_SERIE_RPS INT NULL,
	VALOR_MAO_DE_OBRA DECIMAL(18,2),
	ID_TIPOPAGTO INT ,
	ID_SITUACAOPAGTO INT,
	PRIMARY KEY CLUSTERED 
	(
		[ID] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] 

--OK
ALTER TABLE [saobento_sistema].[FAT_FATURAMENTO]  WITH CHECK ADD FOREIGN KEY([ID_OSSB])
REFERENCES [saobento_sistema].[OSSB] ([ID])
GO
--OK
ALTER TABLE [saobento_sistema].[FAT_FATURAMENTO]  WITH CHECK ADD FOREIGN KEY([ID_EMPRESA])
REFERENCES [saobento_sistema].[EMPRESA] ([ID])
GO
--FALTA CRIAR
ALTER TABLE [saobento_sistema].[FAT_FATURAMENTO]  WITH CHECK ADD FOREIGN KEY([ID_TIPOPAGTO])
REFERENCES [saobento_sistema].[TIPOPAGTO] ([ID])
GO
--FALTA CRIAR
ALTER TABLE [saobento_sistema].[FAT_FATURAMENTO]  WITH CHECK ADD FOREIGN KEY([ID_SITUACAOPAGTO])
REFERENCES [saobento_sistema].[SITUACAOPAGTO] ([ID])
GO

/*
CREATE TABLE atimo_dev.FAT_FATURAMENTO_RETENCOES
(
	ID_FATURAMENTO INT NOT NULL REFERENCES atimo_dev.FAT_FATURAMENTO(ID_FATURAMENTO),
	COD_IMPOSTO INT NOT NULL REFERENCES atimo_dev.FAT_TIPO_IMPOSTO(CODIGO),
	VALOR_RETENCAO DECIMAL(18, 2),
	BASE_CALCULO DECIMAL(18, 2),
	PERCENT_USADO	DECIMAL(10,5)
)
*/
--OK
CREATE TABLE [saobento_sistema].FAT_FATURAMENTO_RETENCAO
(
	ID INT IDENTITY(1,1),
	ID_FATURAMENTO INT NOT NULL,
	ID_TIPO_IMPOSTO INT NOT NULL,
	VALOR_RETENCAO DECIMAL(18, 2),
	BASE_CALCULO DECIMAL(18, 2),
	PERCENT_USADO	DECIMAL(10,5),
	CONSTRAINT [PK_dbo.FAT_FATURAMENTO_RETENCAO] PRIMARY KEY CLUSTERED 
	(
		ID ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [saobento_sistema].[FAT_FATURAMENTO_RETENCAO]  WITH CHECK ADD FOREIGN KEY([ID_FATURAMENTO])
REFERENCES [saobento_sistema].[FAT_FATURAMENTO] ([ID])
GO

ALTER TABLE [saobento_sistema].[FAT_FATURAMENTO_RETENCAO]  WITH CHECK ADD FOREIGN KEY([ID_TIPO_IMPOSTO])
REFERENCES [saobento_sistema].[FAT_TIPO_IMPOSTO] ([ID])
GO


-- OK
CREATE TABLE atimo_dev.MUNICIPIOS
(
	-- CODIGO INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	ID INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
 	NOME VARCHAR(100),
 	CODIGO_IBGE VARCHAR(10),
	UF VARCHAR(2)
)
